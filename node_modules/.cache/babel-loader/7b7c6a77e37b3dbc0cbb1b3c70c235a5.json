{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect,useRef}from'react';//API\nimport API from'../API';//Helpers\nimport{isPersistedState}from'../helpers';//config\n// import { POSTER_SIZE, BACKDROP_SIZE, IMAGE_BASE_URL } from '../config';\nvar initialState={page:0,results:[],total_pages:0,total_results:0};export var useHomeFetch=function useHomeFetch(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),searchTerm=_useState2[0],setSearchTerm=_useState2[1];var _useState3=useState(initialState),_useState4=_slicedToArray(_useState3,2),state=_useState4[0],setState=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isLoadingMore=_useState10[0],setIsLoadingMore=_useState10[1];// console.log(searchTerm);\nvar fetchMovies=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(page){var searchTerm,movies,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:searchTerm=_args.length>1&&_args[1]!==undefined?_args[1]:'';_context.prev=1;setError(false);setLoading(true);_context.next=6;return API.fetchMovies(searchTerm,page);case 6:movies=_context.sent;// console.log(movies);\nsetState(function(prev){return _objectSpread(_objectSpread({},movies),{},{results:page>1?[].concat(_toConsumableArray(prev.results),_toConsumableArray(movies.results)):_toConsumableArray(movies.results)});});_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);setError(true);case 13:setLoading(false);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function fetchMovies(_x){return _ref.apply(this,arguments);};}();// Initial and Search\nuseEffect(function(){if(!searchTerm){var sessionState=isPersistedState('homeState');if(sessionState){console.log('Getting from SessionStorage');setState(sessionState);return;}}console.log('Getting from API');setState(initialState);fetchMovies(1,searchTerm);},[searchTerm]);//Load More\nuseEffect(function(){if(!isLoadingMore)return;fetchMovies(state.page+1,searchTerm);setIsLoadingMore(false);},[isLoadingMore,searchTerm,state.page]);// Write to sessionStorage\nuseEffect(function(){if(!searchTerm)sessionStorage.setItem('homeState',JSON.stringify(state));},[searchTerm,state]);return{state:state,loading:loading,error:error,searchTerm:searchTerm,setSearchTerm:setSearchTerm,setIsLoadingMore:setIsLoadingMore};};","map":{"version":3,"sources":["C:/Users/gaura/OneDrive/Desktop/react_crash_course/prime_moviedb/src/hooks/useHomeFetch.js"],"names":["useState","useEffect","useRef","API","isPersistedState","initialState","page","results","total_pages","total_results","useHomeFetch","searchTerm","setSearchTerm","state","setState","loading","setLoading","error","setError","isLoadingMore","setIsLoadingMore","fetchMovies","movies","prev","sessionState","console","log","sessionStorage","setItem","JSON","stringify"],"mappings":"muBAAA,OAASA,QAAT,CAAmBC,SAAnB,CAA8BC,MAA9B,KAA2C,OAA3C,CAEA;AACA,MAAOC,CAAAA,GAAP,KAAgB,QAAhB,CAEA;AACA,OAASC,gBAAT,KAAiC,YAAjC,CAEA;AACA;AACA,GAAMC,CAAAA,YAAY,CAAG,CACjBC,IAAI,CAAC,CADY,CAEjBC,OAAO,CAAC,EAFS,CAGjBC,WAAW,CAAC,CAHK,CAIjBC,aAAa,CAAC,CAJG,CAArB,CAOA,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAK,CAE7B,cAAoCV,QAAQ,CAAC,EAAD,CAA5C,wCAAOW,UAAP,eAAmBC,aAAnB,eAEA,eAA0BZ,QAAQ,CAACK,YAAD,CAAlC,yCAAOQ,KAAP,eAAcC,QAAd,eAEA,eAA8Bd,QAAQ,CAAC,KAAD,CAAtC,yCAAOe,OAAP,eAAgBC,UAAhB,eAEA,eAA0BhB,QAAQ,CAAC,KAAD,CAAlC,yCAAOiB,KAAP,eAAcC,QAAd,eAEA,eAA0ClB,QAAQ,CAAC,KAAD,CAAlD,0CAAOmB,aAAP,gBAAsBC,gBAAtB,gBAEA;AAEA,GAAMC,CAAAA,WAAW,0FAAG,iBAAMf,IAAN,wJAAYK,UAAZ,+CAAyB,EAAzB,iBAEZO,QAAQ,CAAC,KAAD,CAAR,CACAF,UAAU,CAAC,IAAD,CAAV,CAHY,sBAKSb,CAAAA,GAAG,CAACkB,WAAJ,CAAgBV,UAAhB,CAA4BL,IAA5B,CALT,QAKNgB,MALM,eAMZ;AAEAR,QAAQ,CAAC,SAAAS,IAAI,wCACND,MADM,MAETf,OAAO,CACHD,IAAI,CAAG,CAAP,8BAAeiB,IAAI,CAAChB,OAApB,qBAAgCe,MAAM,CAACf,OAAvC,sBAAsDe,MAAM,CAACf,OAA7D,CAHK,IAAL,CAAR,CARY,iFAcZW,QAAQ,CAAC,IAAD,CAAR,CAdY,QAgBhBF,UAAU,CAAC,KAAD,CAAV,CAhBgB,qEAAH,kBAAXK,CAAAA,WAAW,4CAAjB,CAkBJ;AACIpB,SAAS,CAAC,UAAI,CACV,GAAG,CAACU,UAAJ,CAAe,CACX,GAAMa,CAAAA,YAAY,CAAGpB,gBAAgB,CAAC,WAAD,CAArC,CACA,GAAGoB,YAAH,CAAgB,CACZC,OAAO,CAACC,GAAR,CAAY,6BAAZ,EACAZ,QAAQ,CAACU,YAAD,CAAR,CACA,OACH,CACJ,CACDC,OAAO,CAACC,GAAR,CAAY,kBAAZ,EACAZ,QAAQ,CAACT,YAAD,CAAR,CACAgB,WAAW,CAAC,CAAD,CAAIV,UAAJ,CAAX,CAEH,CAbQ,CAaN,CAACA,UAAD,CAbM,CAAT,CAcJ;AACIV,SAAS,CAAC,UAAM,CACZ,GAAG,CAACkB,aAAJ,CAAmB,OACnBE,WAAW,CAACR,KAAK,CAACP,IAAN,CAAa,CAAd,CAAiBK,UAAjB,CAAX,CACAS,gBAAgB,CAAC,KAAD,CAAhB,CAEH,CALQ,CAKN,CAACD,aAAD,CAAgBR,UAAhB,CAA4BE,KAAK,CAACP,IAAlC,CALM,CAAT,CAOJ;AACIL,SAAS,CAAC,UAAM,CACZ,GAAG,CAACU,UAAJ,CAAgBgB,cAAc,CAACC,OAAf,CAAuB,WAAvB,CAAoCC,IAAI,CAACC,SAAL,CAAejB,KAAf,CAApC,EAGnB,CAJQ,CAIN,CAACF,UAAD,CAAaE,KAAb,CAJM,CAAT,CAMA,MAAO,CAACA,KAAK,CAALA,KAAD,CAAQE,OAAO,CAAPA,OAAR,CAAiBE,KAAK,CAALA,KAAjB,CAAwBN,UAAU,CAAVA,UAAxB,CAAoCC,aAAa,CAAbA,aAApC,CAAmDQ,gBAAgB,CAAhBA,gBAAnD,CAAP,CACH,CA/DM","sourcesContent":["import  {useState, useEffect, useRef} from 'react';\r\n\r\n//API\r\nimport API from '../API';\r\n\r\n//Helpers\r\nimport { isPersistedState } from '../helpers'\r\n\r\n//config\r\n// import { POSTER_SIZE, BACKDROP_SIZE, IMAGE_BASE_URL } from '../config';\r\nconst initialState = {\r\n    page:0,\r\n    results:[],\r\n    total_pages:0,\r\n    total_results:0\r\n};\r\n\r\nexport const useHomeFetch = () =>{\r\n\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    const [state, setState] = useState(initialState);\r\n\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const [error, setError] = useState(false);\r\n\r\n    const [isLoadingMore, setIsLoadingMore] = useState(false);\r\n\r\n    // console.log(searchTerm);\r\n\r\n    const fetchMovies = async(page, searchTerm = '')=>{\r\n        try{\r\n            setError(false);\r\n            setLoading(true);\r\n\r\n            const movies = await API.fetchMovies(searchTerm, page);\r\n            // console.log(movies);\r\n\r\n            setState(prev =>({\r\n                ...movies,\r\n                results:\r\n                    page > 1 ? [...prev.results, ...movies.results] : [...movies.results]\r\n            }));\r\n        }catch(error){\r\n            setError(true);\r\n        }\r\n        setLoading(false);\r\n    };\r\n// Initial and Search\r\n    useEffect(()=>{\r\n        if(!searchTerm){\r\n            const sessionState = isPersistedState('homeState');\r\n            if(sessionState){\r\n                console.log('Getting from SessionStorage')\r\n                setState(sessionState);\r\n                return;\r\n            }\r\n        }\r\n        console.log('Getting from API')\r\n        setState(initialState);\r\n        fetchMovies(1, searchTerm);\r\n\r\n    }, [searchTerm]);\r\n//Load More\r\n    useEffect(() => {\r\n        if(!isLoadingMore) return;\r\n        fetchMovies(state.page + 1, searchTerm);\r\n        setIsLoadingMore(false);\r\n        \r\n    }, [isLoadingMore, searchTerm, state.page]);\r\n\r\n// Write to sessionStorage\r\n    useEffect(() => {\r\n        if(!searchTerm) sessionStorage.setItem('homeState', JSON.stringify(state));\r\n        \r\n        \r\n    }, [searchTerm, state]);\r\n\r\n    return {state, loading, error, searchTerm, setSearchTerm, setIsLoadingMore};\r\n};"]},"metadata":{},"sourceType":"module"}